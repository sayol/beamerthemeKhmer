\mode<presentation>

\usefonttheme{professionalfonts}
\RequirePackage{newpxmath}

\setbeamerfont{normal text}{} % ignored currently
\setbeamerfont{alerted text}{}
\setbeamerfont{example text}{}

\setbeamerfont{structure}{}
\setbeamerfont{tiny structure}{size=\tiny}

\setbeamerfont{title}{family=\sffamily,size=\Large,parent=structure}
\setbeamerfont{title in head/foot}{family=\sffamily}
\setbeamerfont{title in sidebar}{size=\tiny}

\setbeamerfont{subtitle}{size=\normalsize,parent=title}

\setbeamerfont{author}{family=\sffamily,size=\large}
\setbeamerfont{author in head/foot}{family=\sffamily}
\setbeamerfont{author in sidebar}{size=\tiny}

\setbeamerfont{institute}{family=\ttfamily,size=\normalsize}
\setbeamerfont{institute in head/foot}{family=\sffamily}
\setbeamerfont{institute in sidebar}{}

\setbeamerfont{date}{family=\sffamily,size=\normalsize}
\setbeamerfont{date in head/foot}{family=\sffamily}
\setbeamerfont{date in sidebar}{}

\setbeamerfont{page number in head/foot}{family=\sffamily}

\setbeamerfont{part name}{size=\LARGE}
\setbeamerfont{part title}{size=\LARGE,parent=title}

\setbeamerfont{section name}{size=\Large}
\setbeamerfont{section title}{size=\Large,parent=title}

\setbeamerfont{section in toc}{family=\sffamily,parent=structure}
\setbeamerfont{section in toc shaded}{family=\sffamily,parent=section in toc}
\setbeamerfont{section in head/foot}{family=\sffamily}
\setbeamerfont{section in sidebar}{size=\tiny}
\setbeamerfont{section number projected}{family=\sffamily,size=\small,parent={section in toc,projected text}}

\setbeamerfont{subsection name}{size=\large}
\setbeamerfont{subsection title}{size=\large,parent=title}

\setbeamerfont{subsection in toc}{}
\setbeamerfont{subsection in toc shaded}{parent=subsection in toc}
\setbeamerfont{subsection in head/foot}{family=\sffamily}
\setbeamerfont{subsection in sidebar}{}

\setbeamerfont{subsubsection in toc}{size=\footnotesize}
\setbeamerfont{subsubsection in toc shaded}{parent=subsubsection in toc}
\setbeamerfont{subsubsection in head/foot}{family=\sffamily}
\setbeamerfont{subsubsection in sidebar}{}

\setbeamerfont{headline}{parent={tiny structure}}
\setbeamerfont{footline}{parent={tiny structure}}

\setbeamerfont{sidebar}{size=\Tiny,parent={tiny structure}}
\setbeamerfont{sidebar left}{parent=sidebar}
\setbeamerfont{sidebar right}{parent=sidebar}

\setbeamerfont{frametitle}{parent=structure,family=\sffamily,size=\large}
\setbeamerfont{framesubtitle}{parent=frametitle,size=\footnotesize}

\setbeamerfont{caption}{size=\small}
\setbeamerfont{caption name}{parent={structure,caption}}

\setbeamerfont{button}{size=\tiny}

\setbeamerfont{block body}{}
\setbeamerfont{block body alerted}{}
\setbeamerfont{block body example}{}
\setbeamerfont{block title}{family=\sffamily,size=\scriptsize,parent={structure,block body}}
\setbeamerfont{block title alerted}{parent={block title,alerted text}}
\setbeamerfont{block title example}{parent={block title,example text}}

\setbeamerfont{item}{parent=structure}
\setbeamerfont{subitem}{parent=item}
\setbeamerfont{subsubitem}{parent=subitem}

\setbeamerfont{item projected}{family=\ttfamily,size=\scriptsize,parent={item,projected text}}
\setbeamerfont{subitem projected}{parent=item projected}
\setbeamerfont{subsubitem projected}{parent=subitem projected}

\setbeamerfont{itemize item}{parent=item}
\setbeamerfont{itemize subitem}{parent=subitem}
\setbeamerfont{itemize subsubitem}{parent=subsubitem}

\setbeamerfont{enumerate item}{parent=item}
\setbeamerfont{enumerate subitem}{parent=subitem}
\setbeamerfont{enumerate subsubitem}{parent=subsubitem}

\setbeamerfont{itemize/enumerate body}{}
\setbeamerfont{itemize/enumerate subbody}{size=\normalsize}
\setbeamerfont{itemize/enumerate subsubbody}{size=\normalsize}

\setbeamerfont{description item}{parent=item}

\setbeamerfont{description body}{}

\setbeamerfont{projected text}{parent={tiny structure}}

\setbeamerfont{abstract}{size=\small}
\setbeamerfont{abstract title}{parent={abstract,structure},size=\normalsize}

\setbeamerfont{verse}{family=\rmfamily,shape=\itshape}

\setbeamerfont{quotation}{shape=\itshape}
\setbeamerfont{quote}{parent=quotation}

\setbeamerfont{note page}{size=\small}
\setbeamerfont{note title}{parent=note page}
\setbeamerfont{note date}{size=\footnotesize}

\mode<all>
%TODO: Khmer (Cambodian)
\RequirePackage[no-math]{fontspec}% no math font
\setmainfont{Khmer OS System}% roman font
\setsansfont{Khmer OS Muol Light}% sans serif font
\setmonofont{Khmer OS Bokor}% typewriter font
\XeTeXlinebreaklocale "khm"% line break rule
\XeTeXlinebreakskip = 0pt plus 1pt minus 0.5pt% line break skip
%TODO: try to add 2 more key to `enumerate' called [m] and [k]
\def\@enloop@{%
    \ifx A\@entemp \def\@tempa{\@enLabel\Alph  }\else
    \ifx a\@entemp \def\@tempa{\@enLabel\alph  }\else
    \ifx i\@entemp \def\@tempa{\@enLabel\roman }\else
    \ifx I\@entemp \def\@tempa{\@enLabel\Roman }\else
    \ifx 1\@entemp \def\@tempa{\@enLabel\arabic}\else
    \ifx k\@entemp \def\@tempa{\@enLabel\alpkh }\else% added
    \ifx m\@entemp \def\@tempa{\@enLabel\khmer }\else% added
    \ifx \@sptoken\@entemp \let\@tempa\@enSpace \else
    \ifx \bgroup\@entemp \let\@tempa\@enGroup \else
    \ifx \@enum@\@entemp \let\@tempa\@gobble \else
    \let\@tempa\@enOther
    \@enhook
    \fi\fi\fi\fi\fi\fi\fi\fi\fi\fi% 2 \fi added
    \@tempa}
%
\RequirePackage{expl3}
%todo: Define Khmer Numbers
\ExplSyntaxOn
\cs_new:Npn \l_khmer_counter:n #1 {
    \exp_after:wN \int_to_khmer:n \cs:w c@#1 \cs_end:
}
\cs_new:Npn \int_to_khmer:n #1 {
    \exp_after:wN \_int_to_khmer:n \__int_value:w #1 \q_nil
}
\cs_new:Npn \_int_to_khmer:n #1 {
    \if_meaning:w #1 \q_nil
    \else:%
    \if_case:w #1
    ០ \or: ១ \or: ២ \or: ៣ \or: ៤ \or: ៥ \or: ៦ \or: ៧ \or: ៨ \or: ៩
    \fi:%
    \exp_after:wN \_int_to_khmer:n
    \fi:
}
\tex_let:D \@khmer \int_to_khmer:n
\tex_let:D \khmer \l_khmer_counter:n
\cs_new:Npn \l_khmer_numeral:n #1 { \_int_to_khmer:n #1 \q_nil }
\tex_let:D \khmernumeral \l_khmer_numeral:n
%todo: Define Khmer Alphabets
\cs_new:Npn \alpkh #1 {
    \exp_after:wN \int_to_khmer_alph:n \cs:w c@#1\cs_end:
}
\cs_new:Npn \int_to_khmer_alph:n #1{
    \int_to_symbols:nnn { #1 }{ 33 }{
        {1}{ក} {2}{ខ} {3}{គ} {4}{ឃ} {5}{ង} 
        {6}{ច} {7}{ឆ} {8}{ជ} {9}{ឈ} {10}{ញ} 
        {11}{ដ} {12}{ឋ} {13}{ឌ} {14}{ឍ} {15}{ណ} 
        {16}{ត} {17}{ថ} {18}{ទ} {19}{ធ} {20}{ន} 
        {21}{ប} {22}{ផ} {23}{ព} {24}{ភ} {25}{ម} 
        {26}{យ} {27}{រ} {28}{ល} {29}{វ} {30}{ស} 
        {31}{ហ} {32}{ឡ} {33}{អ}
    }
}
%
\tex_let:D \@alpkh \int_to_khmer_alph:n
\tex_let:D \@Alpkh \int_to_khmer_alph:n
%todo: Define Khmer Short Date dd/mm/yyyy
\tl_new:N \l_khmer_short_date_tl
\tl_set:Nn \l_khmer_short_date_tl {%
    \if_int_compare:w \c_sys_day_int < 10
    \int_to_khmer:n { 0\c_sys_day_int }
    \else:
    \int_to_khmer:n \c_sys_day_int
    \fi:
    /
    \if_int_compare:w \c_sys_month_int < 10
    \int_to_khmer:n { 0\c_sys_month_int }
    \else:
    \int_to_khmer:n \c_sys_month_int
    \fi:%
    /
    \int_to_khmer:n \c_sys_year_int
}
\tex_let:D \khmershortdate \l_khmer_short_date_tl
%TODO: Translate day, month and year labels to Khmer language
\tl_new:N \l_khmer_day_label_tl
\tl_set:Nn \l_khmer_day_label_tl { ថ្ងៃទី }
\tl_new:N \l_khmer_month_label_tl
\tl_set:Nn \l_khmer_month_label_tl { ខែ }
\tl_new:N \l_khmer_year_label_tl
\tl_set:Nn \l_khmer_year_label_tl { ឆ្នាំ }
%TODO: Translate the twelve months to Khmer language
\tl_new:N \l_january_in_khmer_tl
\tl_set:Nn \l_january_in_khmer_tl { មករា }
\tl_new:N \l_february_in_khmer_tl
\tl_set:Nn \l_february_in_khmer_tl { កុម្ភៈ }
\tl_new:N \l_march_in_khmer_tl
\tl_set:Nn \l_march_in_khmer_tl { មីនា }
\tl_new:N \l_april_in_khmer_tl
\tl_set:Nn \l_april_in_khmer_tl { មេសា }
\tl_new:N \l_may_in_khmer_tl
\tl_set:Nn \l_may_in_khmer_tl { ឧសភា }
\tl_new:N \l_june_in_khmer_tl
\tl_set:Nn \l_june_in_khmer_tl { មិថុនា }
\tl_new:N \l_july_in_khmer_tl
\tl_set:Nn \l_july_in_khmer_tl { កក្កដា }
\tl_new:N \l_august_in_khmer_tl
\tl_set:Nn \l_august_in_khmer_tl { សីហា }
\tl_new:N \l_september_in_khmer_tl
\tl_set:Nn \l_september_in_khmer_tl { កញ្ញា }
\tl_new:N \l_october_in_khmer_tl
\tl_set:Nn \l_october_in_khmer_tl { តុលា }
\tl_new:N \l_november_in_khmer_tl
\tl_set:Nn \l_november_in_khmer_tl { វិច្ឆិកា }
\tl_new:N \l_december_in_khmer_tl
\tl_set:Nn \l_december_in_khmer_tl { ធ្នូ }
%TODO: Define Khmer Date dd~month~yyyy
\tl_new:N \l_khmer_date_tl
\tl_set:Nn \l_khmer_date_tl {%
    \l_khmer_day_label_tl~
    \if_int_compare:w \c_sys_day_int < 10
    \int_to_khmer:n { 0\c_sys_day_int }
    \else:
    \int_to_khmer:n \c_sys_day_int
    \fi:{}~
    \l_khmer_month_label_tl~
    \if_case:w \c_sys_month_int
    \or: \l_january_in_khmer_tl \or: \l_february_in_khmer_tl\or: \l_march_in_khmer_tl\or: \l_april_in_khmer_tl\or: \l_may_in_khmer_tl\or: \l_june_in_khmer_tl\or: \l_july_in_khmer_tl\or: \l_august_in_khmer_tl\or: \l_september_in_khmer_tl\or: \l_october_in_khmer_tl\or: \l_november_in_khmer_tl\or: \l_december_in_khmer_tl
    \fi:{}~
    \l_khmer_year_label_tl~
    \int_to_khmer:n \c_sys_year_int
}
\tex_let:D \khmerdate \l_khmer_date_tl
%TODO: khmer counter
\tl_new:N \l_section_counter:n
\tl_set:Nn \l_section_counter:n { \l_khmer_counter:n { section } }
\tex_let:D \thesection \l_section_counter:n
\tl_new:N \l_theorem_counter:n
\tl_set:Nn \l_theorem_counter:n { \l_khmer_counter:n { theorem } }
\tex_let:D \thetheorem \l_theorem_counter:n
%TODO: translate captions to Khmer
\tl_new:N \l_fact_name_tl
\tl_set:Nn \l_fact_name_tl { ស្វ័យសត្យ }
\tl_new:N \l_lemma_name_tl
\tl_set:Nn \l_lemma_name_tl { បទគន្លិះ }
\tl_new:N \l_theorem_name_tl
\tl_set:Nn \l_theorem_name_tl { ទ្រឹស្ដីបទ }
\tl_new:N \l_corollary_name_tl
\tl_set:Nn \l_corollary_name_tl { អនុសាធ្យ }
\tl_new:N \l_problem_name_tl
\tl_set:Nn \l_problem_name_tl { ចំណោទ }
\tl_new:N \l_solution_name_tl
\tl_set:Nn \l_solution_name_tl { ដំណោះស្រាយ }
\tl_new:N \l_definition_name_tl
\tl_set:Nn \l_definition_name_tl { និយមន័យ }
\tl_new:N \l_example_name_tl
\tl_set:Nn \l_example_name_tl { ឧទាហរណ៏ }
\tl_new:N \l_proof_name_tl
\tl_set:Nn \l_proof_name_tl { សម្រាយបញ្ជាក់ }
\tex_let:D \proofname \l_proof_name_tl
\uselanguage{khmer}%
\languagepath{khmer}%
\cs_new:Nn \l_translate_to_khmer:nn { \deftranslation[to=khmer]{ #1 }{ #2 } }
\l_translate_to_khmer:nn { Fact }{ \l_fact_name_tl }%
\l_translate_to_khmer:nn { Lemma }{ \l_lemma_name_tl }%
\l_translate_to_khmer:nn { Theorem }{ \l_theorem_name_tl }%
\l_translate_to_khmer:nn { Corollary }{ \l_corollary_name_tl }%
\l_translate_to_khmer:nn { Problem }{ \l_problem_name_tl }%
\l_translate_to_khmer:nn { Solution }{ \l_solution_name_tl }%
\l_translate_to_khmer:nn { Definition }{ \l_definition_name_tl }%
\l_translate_to_khmer:nn { Definitions }{ \l_definition_name_tl }%
\l_translate_to_khmer:nn { Example }{ \l_example_name_tl }%
\l_translate_to_khmer:nn { Examples }{ \l_example_name_tl }%
\l_translate_to_khmer:nn { Proof }{ \l_proof_name_tl }%
\ExplSyntaxOff
%